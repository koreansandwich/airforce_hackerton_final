# 🌀 유사 일기도 탐색기법 개발 (Air Force Hackathon 본선 – 최우수상)

본 프로젝트는 2025년 **제7회 공군 AI 해커톤 본선**인 "유사 일기도 탐색기법 개발"을 수행한 결과를 문서화한 리포지토리입니다.  
10년치 일기도 이미지를 활용하여, 입력 이미지와 **강수 여부가 동일한 가장 유사한 일기도 5장을 탐색**하는 시스템을 구축하였고, **Contrastive Learning 기반 기압 분포 벡터 임베딩 + 고저기압 거리 계산** 기법을 조합하여 최종 유사도를 계산하는 방식으로 진행하였습니다.

---

## 🏆 수상

- **최우수상 (2등)**
- 제7회 공군 해커톤 본선  

---

## 📁 대회 개요

| 항목 | 내용 |
|------|------|
| 개발환경 | 도커 컨테이너 기반 Jupyter Notebook (i7 / RTX 4070 Ti / RAM 64GB) |
| 데이터 | 약 37,000장 일기도 이미지 + 기상 관측 수치 데이터 |
| 제출 | `.tar` 압축 파일 (코드, 가중치, 결과, 설명 포함 / 재현 가능 필수) |
| 최종 점수 | 과제 1 (20%) + 과제 2 (20%) + 발표심사 (60%) |

---

## 🗂️ 데이터 구조

- `\dataset\WMap`: 지상/850hPa/500hPa 일기도 이미지 (6시간 간격)
- `\dataset\WMap_ref`: 학습 참조용 일기도 + 유사도 평가 범위 표시 이미지
- `\dataset\ObsData`: 2014–2022년 기상관측 수치 데이터
- `\dataset\ObsData_LB`: 리더보드용 예측 대상 20건 (10일 연속 관측치)
- `\weights`: 사전학습 모델 (Dinov2, Swin, EfficientDet 등)
- `\result`: 제출용 결과 저장 폴더

---

## 📌 과제 설명

### 과제 1 – 유사 일기도 탐색

- **입력**: 지상 일기도 이미지 (518×518 PNG)
- **출력**: 입력 이미지와 강수 여부가 같은 가장 유사한 과거 일기도 5장
- **판단 요소**:
    - 고저기압(H/L)의 상대 위치
    - 등압선의 패턴 및 복잡도
    - 한반도 주변의 강수 여부
- **제외 범위**: 평가일 기준 ±7일 이내의 데이터 제외

---

## ⚙️ 전체 파이프라인 흐름

### 1. 전처리

- 등압선, H/L 기호만 색상 마스킹으로 추출
- 지도 범위 기준 이미지 crop
- 초록색 픽셀 기반 한반도 주변 강수 여부(Rain Flag) 추출

### 2. Contrastive Learning 기반 임베딩

- 시간 간격 <24시간 → Positive Pair, ≥24시간 → Negative Pair
- ResNet 기반 임베딩 모델 + NT-Xent Loss로 학습
- Dino 대비 더 정제된 벡터 공간 확보

### 3. H/L 거리 기반 유사도

- OpenCV `matchTemplate` 활용해 각 이미지에서 H/L 위치 탐지
- 두 이미지 간 H끼리, L끼리 평균 거리 계산
- 저기압(L)에 가중치 부여하여 최종 거리 기반 유사도 산출

### 4. 등압선 기반 기압 분포도 생성

- H/L 제거 + 등압선만 마스킹 → 이미지 Blur 처리
- L 주변 기압 숫자 추출 (OCR + matchTemplate)
- BFS 방식으로 기압 높이 점진 증가 → 분포도 생성
- Contrastive Learning으로 벡터 학습 → 코사인 유사도 계산

### 5. 최종 유사도 계산

- 강수 여부(rain flag)가 동일한 이미지 중:
  ```math
  최종 유사도 = 거리 기반 유사도 × 2 + 등압선 유사도 × 1
- 가장 유사한 5장 이미지 파일명 출력

## 🔍 개선점 및 시행착오

- Dino 단독 사용 성능 한계 → 전처리 + Contrastive 조합이 효과적
- H/L 탐지 정확도 향상 위해 matchTemplate 기준 수동 설정
- 등압선 분포도는 BFS 기반으로 표현해야 유사도 판별 효과 증가
- 등압선 이미지의 공백 보정 → Gaussian Blur + 그라데이션 보정
- SURF 중심 일기도만 활용 → 850hPa / 500hPa 정보는 미활용

## 📂 주요 코드 (복원 구조)

| 파일명                    | 설명                                |
| ---------------------- | --------------------------------- |
| `preprocess_image.ipynb`  | 색상 마스킹 + crop                     |
| `detect_hl.ipynb`         | 고기압/저기압 위치 탐지                     |
| `rain_flag_filter.ipynb`  | 초록색 채널 기반 rain 여부 판단              |
| `pressure_map_bfs.ipynb`  | 등압선 기반 기압 분포도 생성                  |
| `contrastive_train.ipynb` | H/L 기반 및 등압선 기반 contrastive 모델 학습 |
| `search_similar.ipynb`    | 유사도 계산 및 최종 탐색                    |



